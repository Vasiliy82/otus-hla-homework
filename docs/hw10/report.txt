

$ docker compose logs dialogs | grep a770e39b-e947-42a3-ada1-a441bb537b51
dialogs  | 2025-02-14T05:54:02.410Z	DEBUG	started	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Test message from User1 to User2", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc"}
dialogs  | 2025-02-14T05:54:02.410Z	DEBUG	r.getDialogId()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "dialogId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T05:54:02.410Z	DEBUG	Tran begin	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T05:54:02.411Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO dialogs (dialog_id, user_id)\n\t\tVALUES ($1, $2), ($1, $3)\n\t\tON CONFLICT DO NOTHING;\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
dialogs  | 2025-02-14T05:54:02.412Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO messages (dialog_id, author_id, message, transaction_id, saga_status)\n\t\tVALUES ($1, $2, $3, $4, 'pending');\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "Test message from User1 to User2", "$4": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc"}
dialogs  | 2025-02-14T05:54:02.412Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T05:54:02.416Z	DEBUG	Tran commit successful	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T05:54:02.416Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc", "eventType": "MessageSent"}
dialogs  | 2025-02-14T05:54:02.416Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "services.(*dialogService).SendMessage", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Test message from User1 to User2"}
dialogs  | 2025-02-14T05:54:02.538Z	DEBUG	Skipping SagaMessageSent	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc", "eventType": "MessageSent"}
dialogs  | 2025-02-14T05:54:02.557Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T05:54:02.557Z	DEBUG	db.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*dialogRepository).UpdateSagaStatus", "query": "\n\t\tUPDATE messages\n\t\tSET saga_status = $1\n\t\tWHERE transaction_id = $2;", "$1": "committed", "$2": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc"}
dialogs  | 2025-02-14T05:54:02.560Z	DEBUG	db.Exec() finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*dialogRepository).UpdateSagaStatus"}
dialogs  | 2025-02-14T05:54:02.560Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*dialogRepository).UpdateSagaStatus"}

$ docker compose logs counters | grep a770e39b-e947-42a3-ada1-a441bb537b51
counters  | 2025-02-14T05:54:02.538Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T05:54:02.538Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "event": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T05:54:02.538Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*CounterService).IncrementUnread", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T05:54:02.538Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*CombinedCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T05:54:02.538Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T05:54:02.543Z	DEBUG	r.client.Get() returned error	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).GetCounter", "err": "redis: nil"}
counters  | 2025-02-14T05:54:02.543Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*PGCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T05:54:02.545Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*PGCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":0}}
counters  | 2025-02-14T05:54:02.545Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":0}}
counters  | 2025-02-14T05:54:02.545Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T05:54:02.545Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*CombinedCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":0}}
counters  | 2025-02-14T05:54:02.545Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T05:54:02.545Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T05:54:02.546Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T05:54:02.546Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*CombinedCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T05:54:02.546Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*PGCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T05:54:02.549Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "repository.(*PGCounterRepository).SaveCounter"}
counters  | 2025-02-14T05:54:02.549Z	DEBUG	uc.publisher.PublishSagaEvent()	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "successEvent": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}, "err": null}
counters  | 2025-02-14T05:54:02.549Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T05:54:02.557Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T05:54:02.557Z	DEBUG	Skipped	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).Execute"}

$ docker compose logs dialogs | grep 436de90f-e42f-42c3-9710-d5a5ed1ed267
dialogs  | 2025-02-14T07:23:31.401Z	DEBUG	started	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Test response from User2 to User1", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f"}
dialogs  | 2025-02-14T07:23:31.401Z	DEBUG	r.getDialogId()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "dialogId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:23:31.401Z	DEBUG	Tran begin	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:23:31.401Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO dialogs (dialog_id, user_id)\n\t\tVALUES ($1, $2), ($1, $3)\n\t\tON CONFLICT DO NOTHING;\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "$3": "d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:23:31.403Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO messages (dialog_id, author_id, message, transaction_id, saga_status)\n\t\tVALUES ($1, $2, $3, $4, 'pending');\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "$3": "Test response from User2 to User1", "$4": "6a08f0d7-5c89-4eda-84c9-e1966b95635f"}
dialogs  | 2025-02-14T07:23:31.405Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:23:31.408Z	DEBUG	Tran commit successful	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:23:31.408Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:23:31.408Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "services.(*dialogService).SendMessage", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Test response from User2 to User1"}
dialogs  | 2025-02-14T07:23:31.511Z	DEBUG	Skipping SagaMessageSent	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:23:31.530Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:23:31.530Z	DEBUG	db.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*dialogRepository).UpdateSagaStatus", "query": "\n\t\tUPDATE messages\n\t\tSET saga_status = $1\n\t\tWHERE transaction_id = $2;", "$1": "committed", "$2": "6a08f0d7-5c89-4eda-84c9-e1966b95635f"}
dialogs  | 2025-02-14T07:23:31.537Z	DEBUG	db.Exec() finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*dialogRepository).UpdateSagaStatus"}
dialogs  | 2025-02-14T07:23:31.537Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*dialogRepository).UpdateSagaStatus"}

$ docker compose logs counters | grep 436de90f-e42f-42c3-9710-d5a5ed1ed267
counters  | 2025-02-14T07:23:31.511Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:23:31.511Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "event": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:23:31.511Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*CounterService).IncrementUnread", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:23:31.511Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*CombinedCounterRepository).GetCounter", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:23:31.511Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).GetCounter", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:23:31.513Z	DEBUG	r.client.Get() returned error	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).GetCounter", "err": "redis: nil"}
counters  | 2025-02-14T07:23:31.514Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*PGCounterRepository).GetCounter", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:23:31.516Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*PGCounterRepository).GetCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":0}}
counters  | 2025-02-14T07:23:31.516Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":0}}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*CombinedCounterRepository).GetCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":0}}
counters  | 2025-02-14T07:23:31.517Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*CombinedCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:23:31.517Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*PGCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:23:31.522Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "repository.(*PGCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:23:31.522Z	DEBUG	uc.publisher.PublishSagaEvent()	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "successEvent": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}, "err": null}
counters  | 2025-02-14T07:23:31.522Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:23:31.530Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:23:31.530Z	DEBUG	Skipped	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).Execute"}

$ docker compose logs dialogs | grep 8de1c260-cd85-42bd-95b5-13e0ba3d6580
dialogs  | 2025-02-14T07:27:02.730Z	DEBUG	started	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Second test message from User1 to User2", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6"}
dialogs  | 2025-02-14T07:27:02.730Z	DEBUG	r.getDialogId()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "dialogId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:27:02.730Z	DEBUG	Tran begin	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:27:02.730Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO dialogs (dialog_id, user_id)\n\t\tVALUES ($1, $2), ($1, $3)\n\t\tON CONFLICT DO NOTHING;\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
dialogs  | 2025-02-14T07:27:02.731Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO messages (dialog_id, author_id, message, transaction_id, saga_status)\n\t\tVALUES ($1, $2, $3, $4, 'pending');\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "Second test message from User1 to User2", "$4": "bad35608-e197-4da5-8e3f-9dfec3907dc6"}
dialogs  | 2025-02-14T07:27:02.733Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:27:02.737Z	DEBUG	Tran commit successful	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:27:02.737Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:27:02.737Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "services.(*dialogService).SendMessage", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Second test message from User1 to User2"}
dialogs  | 2025-02-14T07:27:02.842Z	DEBUG	Skipping SagaMessageSent	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:27:02.857Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:27:02.857Z	DEBUG	db.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*dialogRepository).UpdateSagaStatus", "query": "\n\t\tUPDATE messages\n\t\tSET saga_status = $1\n\t\tWHERE transaction_id = $2;", "$1": "committed", "$2": "bad35608-e197-4da5-8e3f-9dfec3907dc6"}
dialogs  | 2025-02-14T07:27:02.860Z	DEBUG	db.Exec() finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*dialogRepository).UpdateSagaStatus"}
dialogs  | 2025-02-14T07:27:02.860Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*dialogRepository).UpdateSagaStatus"}

$ docker compose logs counters | grep 8de1c260-cd85-42bd-95b5-13e0ba3d6580
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "event": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*CounterService).IncrementUnread", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*CombinedCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*RedisCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*RedisCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*CombinedCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T07:27:02.843Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:27:02.843Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:27:02.844Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:27:02.844Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*CombinedCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:27:02.844Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*PGCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:27:02.850Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "repository.(*PGCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:27:02.850Z	DEBUG	uc.publisher.PublishSagaEvent()	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "successEvent": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}, "err": null}
counters  | 2025-02-14T07:27:02.850Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:27:02.857Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:27:02.857Z	DEBUG	Skipped	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).Execute"}

$ docker compose logs dialogs | grep 57dfd8e5-9ae2-413b-bac9-5d0ace7875b4
dialogs  | 2025-02-14T07:31:36.042Z	DEBUG	started	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Second test response from User2 to User1", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a"}
dialogs  | 2025-02-14T07:31:36.042Z	DEBUG	r.getDialogId()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "dialogId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:31:36.042Z	DEBUG	Tran begin	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:31:36.043Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO dialogs (dialog_id, user_id)\n\t\tVALUES ($1, $2), ($1, $3)\n\t\tON CONFLICT DO NOTHING;\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "$3": "d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:31:36.044Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO messages (dialog_id, author_id, message, transaction_id, saga_status)\n\t\tVALUES ($1, $2, $3, $4, 'pending');\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "$3": "Second test response from User2 to User1", "$4": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a"}
dialogs  | 2025-02-14T07:31:36.045Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:31:36.058Z	DEBUG	Tran commit successful	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:31:36.059Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:31:36.059Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "services.(*dialogService).SendMessage", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Second test response from User2 to User1"}
dialogs  | 2025-02-14T07:31:36.162Z	DEBUG	Skipping SagaMessageSent	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:31:36.174Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:31:36.175Z	DEBUG	db.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*dialogRepository).UpdateSagaStatus", "query": "\n\t\tUPDATE messages\n\t\tSET saga_status = $1\n\t\tWHERE transaction_id = $2;", "$1": "committed", "$2": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a"}
dialogs  | 2025-02-14T07:31:36.179Z	DEBUG	db.Exec() finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*dialogRepository).UpdateSagaStatus"}
dialogs  | 2025-02-14T07:31:36.179Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*dialogRepository).UpdateSagaStatus"}

$ docker compose logs counters | grep 57dfd8e5-9ae2-413b-bac9-5d0ace7875b4
counters  | 2025-02-14T07:31:36.161Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "event": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*CounterService).IncrementUnread", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*CombinedCounterRepository).GetCounter", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*RedisCounterRepository).GetCounter", "dialogID": "d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*RedisCounterRepository).GetCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*CombinedCounterRepository).GetCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:31:36.162Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":2}}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":2}}
counters  | 2025-02-14T07:31:36.162Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:31:36.163Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*CombinedCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":2}}
counters  | 2025-02-14T07:31:36.163Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*PGCounterRepository).SaveCounter", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":2}}
counters  | 2025-02-14T07:31:36.168Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "repository.(*PGCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:31:36.168Z	DEBUG	uc.publisher.PublishSagaEvent()	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "successEvent": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}, "err": null}
counters  | 2025-02-14T07:31:36.168Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:31:36.175Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:31:36.175Z	DEBUG	Skipped	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).Execute"}

$ docker compose logs dialogs | grep INFO
dialogs  | 2025-02-14T05:47:14.433Z	INFO	Initializing services...	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "func": "main.main"}
dialogs  | 2025-02-14T05:47:14.433Z	INFO	Initializing PostgreSQL connection...	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "func": "main.main"}
dialogs  | 2025-02-14T05:47:14.433Z	INFO	connection pool established: postgres://app_hw:Passw0rd@postgres:5432/hw	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "func": "postgresqldb.initDBInstance"}
dialogs  | 2025-02-14T05:47:14.436Z	INFO	Server is running on :8080	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "func": "main.main"}
dialogs  | 2025-02-14T05:54:02.416Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc", "eventType": "MessageSent"}
dialogs  | 2025-02-14T05:54:02.416Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "services.(*dialogService).SendMessage", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Test message from User1 to User2"}
dialogs  | 2025-02-14T05:54:02.557Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "transactionID": "1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:23:31.408Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:23:31.408Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "services.(*dialogService).SendMessage", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Test response from User2 to User1"}
dialogs  | 2025-02-14T07:23:31.530Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "transactionID": "6a08f0d7-5c89-4eda-84c9-e1966b95635f", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:27:02.737Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:27:02.737Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "services.(*dialogService).SendMessage", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "Second test message from User1 to User2"}
dialogs  | 2025-02-14T07:27:02.857Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "transactionID": "bad35608-e197-4da5-8e3f-9dfec3907dc6", "eventType": "CounterIncremented"}
dialogs  | 2025-02-14T07:31:36.059Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:31:36.059Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "userID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "func": "services.(*dialogService).SendMessage", "myId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "partnerId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "message": "Second test response from User2 to User1"}
dialogs  | 2025-02-14T07:31:36.174Z	INFO	Processing SagaCounterIncremented	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "transactionID": "0d0c155f-4677-42f7-8ac2-9dee4d2f254a", "eventType": "CounterIncremented"}

$ docker compose logs counters | grep INFO
counters  | 2025-02-14T05:47:14.420Z	INFO	Configuration validation successful!	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819"}
counters  | 2025-02-14T05:47:14.422Z	INFO	connection pool established: postgres://app_hw:Passw0rd@postgres-counters:5432/hw	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "func": "internal.initDBInstance"}
counters  | 2025-02-14T05:54:02.545Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":1}}
counters  | 2025-02-14T05:54:02.549Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "a770e39b-e947-42a3-ada1-a441bb537b51", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:23:31.517Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":1}}
counters  | 2025-02-14T07:23:31.522Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "436de90f-e42f-42c3-9710-d5a5ed1ed267", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}
counters  | 2025-02-14T07:27:02.843Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:27:02.850Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "8de1c260-cd85-42bd-95b5-13e0ba3d6580", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:31:36.162Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3","unread_count":2}}
counters  | 2025-02-14T07:31:36.168Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "57dfd8e5-9ae2-413b-bac9-5d0ace7875b4", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}}


$ docker compose logs dialogs | grep 15af67c2-1e63-4ae0-8b9e-928560559117
dialogs  | 2025-02-14T07:42:05.586Z	DEBUG	started	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "This message will fail", "transactionID": "5967edda-faf0-4c2f-9dbe-86e76813457a"}
dialogs  | 2025-02-14T07:42:05.586Z	DEBUG	r.getDialogId()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "dialogId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
dialogs  | 2025-02-14T07:42:05.586Z	DEBUG	Tran begin	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:42:05.586Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO dialogs (dialog_id, user_id)\n\t\tVALUES ($1, $2), ($1, $3)\n\t\tON CONFLICT DO NOTHING;\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
dialogs  | 2025-02-14T07:42:05.587Z	DEBUG	tx.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga", "query": "\n\t\tINSERT INTO messages (dialog_id, author_id, message, transaction_id, saga_status)\n\t\tVALUES ($1, $2, $3, $4, 'pending');\n\t", "$1": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603", "$2": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "$3": "This message will fail", "$4": "5967edda-faf0-4c2f-9dbe-86e76813457a"}
dialogs  | 2025-02-14T07:42:05.588Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:42:05.590Z	DEBUG	Tran commit successful	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "repository.(*dialogRepository).SaveMessageWithSaga"}
dialogs  | 2025-02-14T07:42:05.590Z	INFO	Saga event published	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "transactionID": "5967edda-faf0-4c2f-9dbe-86e76813457a", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:42:05.590Z	INFO	success	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "userID": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "func": "services.(*dialogService).SendMessage", "myId": "d86c3ba3-0628-4716-88b8-a51ec02bc603", "partnerId": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3", "message": "This message will fail"}
dialogs  | 2025-02-14T07:42:05.693Z	DEBUG	Skipping SagaMessageSent	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "transactionID": "5967edda-faf0-4c2f-9dbe-86e76813457a", "eventType": "MessageSent"}
dialogs  | 2025-02-14T07:42:05.704Z	INFO	Processing SagaCounterIncrementFailed	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "transactionID": "5967edda-faf0-4c2f-9dbe-86e76813457a", "eventType": "CounterIncrementFailed"}
dialogs  | 2025-02-14T07:42:05.704Z	DEBUG	db.Exec()	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*dialogRepository).UpdateSagaStatus", "query": "\n\t\tUPDATE messages\n\t\tSET saga_status = $1\n\t\tWHERE transaction_id = $2;", "$1": "failed", "$2": "5967edda-faf0-4c2f-9dbe-86e76813457a"}
dialogs  | 2025-02-14T07:42:05.711Z	DEBUG	db.Exec() finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*dialogRepository).UpdateSagaStatus"}
dialogs  | 2025-02-14T07:42:05.711Z	DEBUG	finished	{"service": "dialogs", "instance_id": "d96a0277-2bbb-46bb-a158-cb5353bc2aed", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*dialogRepository).UpdateSagaStatus"}

$ docker compose logs counters | grep 15af67c2-1e63-4ae0-8b9e-928560559117
counters  | 2025-02-14T07:42:05.693Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:42:05.693Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "event": {"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}}
counters  | 2025-02-14T07:42:05.693Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*CounterService).IncrementUnread", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:42:05.693Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*CombinedCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:42:05.693Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*RedisCounterRepository).GetCounter", "dialogID": "b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*RedisCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*CombinedCounterRepository).GetCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":2}}
counters  | 2025-02-14T07:42:05.694Z	INFO	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*CounterService).IncrementUnread", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":3}}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*RedisCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":3}}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*RedisCounterRepository).SaveCounter"}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Success	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*CombinedCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":3}}
counters  | 2025-02-14T07:42:05.694Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*PGCounterRepository).SaveCounter", "counter": {"dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","unread_count":3}}
counters  | 2025-02-14T07:42:05.697Z	DEBUG	r.db.Exec() returned error	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "repository.(*PGCounterRepository).SaveCounter", "err": "ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}
counters  | 2025-02-14T07:42:05.697Z	DEBUG	uc.counterService.IncrementUnread() returned error	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "err": "ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}
counters  | 2025-02-14T07:42:05.697Z	DEBUG	uc.publisher.PublishSagaEvent()	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).handleMessageSent", "failEvent": {"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"CounterIncrementFailed","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","error":"ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}, "err": null}
counters  | 2025-02-14T07:42:05.697Z	WARN	Failure	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}, "err": "ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}
counters  | 2025-02-14T07:42:05.704Z	DEBUG	Started	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).Execute", "event": {"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"CounterIncrementFailed","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","error":"ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}}
counters  | 2025-02-14T07:42:05.704Z	DEBUG	Skipped	{"service": "counters", "instance_id": "85db8f62-33fd-4f3f-bd12-ed8fc6371819", "RequestID": "15af67c2-1e63-4ae0-8b9e-928560559117", "func": "usecases.(*ProcessSagaEventUseCase).Execute"}

$ docker compose exec kafka /bin/bash -c "unset KAFKA_OPTS && kafka-console-consumer --bootstrap-server localhost:9092 --topic mysocnet-saga-bus --from-beginning --property print.headers=true"
X-Request-ID:a770e39b-e947-42a3-ada1-a441bb537b51	{"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
X-Request-ID:57dfd8e5-9ae2-413b-bac9-5d0ace7875b4	{"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
X-Request-ID:a770e39b-e947-42a3-ada1-a441bb537b51	{"transaction_id":"1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
X-Request-ID:436de90f-e42f-42c3-9710-d5a5ed1ed267	{"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"CounterIncremented","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
X-Request-ID:8de1c260-cd85-42bd-95b5-13e0ba3d6580	{"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"CounterIncremented","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
X-Request-ID:57dfd8e5-9ae2-413b-bac9-5d0ace7875b4	{"transaction_id":"0d0c155f-4677-42f7-8ac2-9dee4d2f254a","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
X-Request-ID:436de90f-e42f-42c3-9710-d5a5ed1ed267	{"transaction_id":"6a08f0d7-5c89-4eda-84c9-e1966b95635f","type":"MessageSent","dialog_id":"d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3"}
X-Request-ID:8de1c260-cd85-42bd-95b5-13e0ba3d6580	{"transaction_id":"bad35608-e197-4da5-8e3f-9dfec3907dc6","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
X-Request-ID:15af67c2-1e63-4ae0-8b9e-928560559117	{"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"MessageSent","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603"}
X-Request-ID:15af67c2-1e63-4ae0-8b9e-928560559117	{"transaction_id":"5967edda-faf0-4c2f-9dbe-86e76813457a","type":"CounterIncrementFailed","dialog_id":"b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603","error":"ERROR: new row for relation \"dialog_counters\" violates check constraint \"unread_count_check\" (SQLSTATE 23514)"}
^CProcessed a total of 10 messages

$ docker compose exec postgres psql -U app_hw -d hw -t --pset pager=off -c "SELECT * FROM messages;"
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |          1 | d86c3ba3-0628-4716-88b8-a51ec02bc603 | 2025-02-14 05:54:02.410961 | Test message from User1 to User2         | 1b1e57ad-70a6-4aaf-99c2-3c5deb6d06fc | committed
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |          2 | b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3 | 2025-02-14 07:23:31.401496 | Test response from User2 to User1        | 6a08f0d7-5c89-4eda-84c9-e1966b95635f | committed
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |          3 | d86c3ba3-0628-4716-88b8-a51ec02bc603 | 2025-02-14 07:27:02.730379 | Second test message from User1 to User2  | bad35608-e197-4da5-8e3f-9dfec3907dc6 | committed
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |          4 | b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3 | 2025-02-14 07:31:36.04323  | Second test response from User2 to User1 | 0d0c155f-4677-42f7-8ac2-9dee4d2f254a | committed
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |          5 | d86c3ba3-0628-4716-88b8-a51ec02bc603 | 2025-02-14 07:42:05.586786 | This message will fail                   | 5967edda-faf0-4c2f-9dbe-86e76813457a | failed

$ docker compose exec postgres-counters psql -U app_hw -d hw -t --pset pager=off -c "SELECT * FROM dialog_counters;"
 b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3:d86c3ba3-0628-4716-88b8-a51ec02bc603 |            2
 d86c3ba3-0628-4716-88b8-a51ec02bc603:b3dd0beb-26a1-4437-a7bd-3a57e40bb4e3 |            2
